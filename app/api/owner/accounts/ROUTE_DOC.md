# Owner Accounts API Route Documentation

## Endpoint

`GET /api/owner/accounts`

Returns all top-up and order transactions for the authenticated owner and their staff, grouped by day and member. Only accessible to users who are owners of a restaurant.

---

## Authentication
- Requires a valid JWT access token in the `Authorization` header: `Bearer <token>`
- Only users with `isOwner: true` in the `users` collection are authorized.

---

## Request
No request body required. Only the `Authorization` header is needed.

---

## Logic Overview
1. **Authenticate** user via JWT.
2. **Verify** owner status in `users` collection.
3. **Find** associated restaurant and its staff.
4. **Collect** member IDs: owner and all staff (with their active status).
5. **Fetch** user details for all members.
6. **Query** `topup` and `orders` collections for transactions by members.
7. **Group** transactions by day and member.
8. **Return** categorized stats and details.

---

## Response Structure
Returns a JSON object with `categorizedByDate`, grouping transactions by date and member.

### Top-level fields
- `categorizedByDate`: Object where each key is a date (`YYYY-MM-DD`), and each value is an object mapping member IDs to their transaction details for that day.

### Member object fields
- `info`: Member details (see below)
- `topupTracks`: Array of top-up transactions for the member on that day
- `ordersTracks`: Array of order transactions for the member on that day
- `topupStat`: `{ count, amount }` summary for top-ups
- `orderStat`: `{ count, amount }` summary for orders

### Member info fields
- `id`: User ID (string)
- `isActive`: Boolean, whether staff is active (owner is always active)
- `title`: "Owner" or "Staff"
- `name`, `email`, `phoneNumber`: From users collection

### Example Response
```json
{
  "categorizedByDate": {
    "2025-07-25": {
      "<memberId>": {
        "info": {
          "id": "<memberId>",
          "isActive": true,
          "title": "Owner/Staff",
          "name": "<name>",
          "email": "<email>",
          "phoneNumber": "<phone>"
        },
        "topupTracks": [
          {
            "_id": "...",
            "topupMaker": "<memberId>",
            "amount": 500,
            "createdAt": "2025-07-25T10:00:00.000Z"
            // ...other topup fields
          }
        ],
        "ordersTracks": [
          {
            "_id": "...",
            "succeededBy": "<memberId>",
            "amount": 1200,
            "updatedAt": "2025-07-25T12:00:00.000Z"
            // ...other order fields
          }
        ],
        "topupStat": {
          "count": 1,
          "amount": 500
        },
        "orderStat": {
          "count": 1,
          "amount": 1200
        }
      }
    }
  }
}
```

---

---

## Error Responses
- `401 Unauthorized`: Missing/invalid token, or user is not owner.
- `403 Forbidden`: Invalid or expired token.
- `404 Not Found`: Restaurant not found for owner.
- `500 Server Error`: Unexpected server error.

---

## Notes
- Only active staff are included in the member list.
- Transactions are grouped by ISO date (`YYYY-MM-DD`).
- Stats include count and total amount for both top-ups and orders, per member per day.
- The route does not support pagination; all data is returned for the authenticated owner and their staff.

---

## Author
Generated by GitHub Copilot
